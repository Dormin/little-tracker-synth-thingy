<!DOCTYPE html>
<html>
	<head>
		<title>Test</title>
	</head>
	<body style="padding:16px;background-color:#2d2e39">
		<canvas id="view" width="192" height="144" style="width:384px;height:288px;display:block;margin:auto;image-rendering:pixelated;box-shadow: 0px 0px 32px 0px rgba(0,0,0,0.5)"></canvas>
		<script src="js/audio.js"></script>
		<script src="js/buffer.js"></script>
		<script src="js/canvas.js"></script>
		<script src="js/font.js"></script>
		<script src="js/input.js"></script>
		<script src="js/synth.js"></script>
		<script src="js/tracker.js"></script>
		<script>
			var KeyToNoteMap = {
				"A": -9, // C
				"W": -8, // C#
				"S": -7, // D
				"E": -6, // D#
				"D": -5, // E
				"F": -4, // F
				"T": -3, // F#
				"G": -2, // G
				"Y": -1, // G#
				"H": 0, // A
				"U": 1, // A#
				"J": 2, // B
				"K": 3, // C
				"O": 4, // C#
				"L": 5, // D
			}
			var NumSynths = 1
			var CurrKey = ""

			InitSynths(Tracker.NumTracks)
			InitInput()
			InitCanvas("view")
			InitFont()
			InitTracker()

			StartAudio(OnProcess)

			function OnProcess(OutputL, OutputR, NumSamples) {
				UpdateInput()
				HandleKeyboard()
				ProcessTracker(OutputL, OutputR, NumSamples)
			}

			function HandleKeyboard() {
				for (var Key in KeyToNoteMap) {
					if (KeyWasPressed(Key)) {
						var Note = KeyToNoteMap[Key]
						SynthNoteOn(0, Note)
						CurrKey = Key
						//DrawNote(Note, 4 * 6, 0)
					}
				}

				if (KeyWasReleased(CurrKey)) {
					SynthNoteOff(0)
					CurrKey = 0
				}
			}

			function DrawNote(Note, X, Y) {
				var Octave = ((Note + 9) / 12 | 0) + 4
				Note = (Note % 12 + 12) % 12
				var NoteChar = [65, 65, 66, 67, 67, 68, 68, 69, 70, 70, 71, 71][Note]
				var SharpChar = [45, 35, 45, 45, 35, 45, 35, 45, 45, 35, 45, 35][Note]
				var OctaveChar = 48 + Octave
				SetColor(240, 16, 32)
				DrawRect(X, Y, 18, 6)
				DrawChar(NoteChar, X, Y)
				DrawChar(SharpChar, X + 6, Y)
				DrawChar(OctaveChar, X + 12, Y)
			}

		</script>
	</body>
</html>